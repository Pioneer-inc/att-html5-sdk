<html>
<head>
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script type="text/javascript" src="/lib/att-api-client.js"></script>
<script type="text/javascript">
function successWithJsonObject(response) {
  document.getElementById("result").innerText = JSON.stringify(response);
} 

function success(response) {
  var result = document.getElementById("result");
  if (typeof response === "undefined" || response === "") {
    result.innerText = "Success with no response.";
  }
  else if (response["responseJSON"]) {
    result.innerText = JSON.stringify(response.responseJSON);
  }
  else if (response["innerText"]) {
    result.innerText = response.responseText;
  }
  else {
    result.innerText = response;
  }
}

function fail(error) {
  var result = document.getElementById("result");
  if (error["responseJSON"]) {
    result.innerText = JSON.stringify(error.responseJSON);
  }
  else {
    result.innerText = error.responseText;
  }
}

function loaded() {
  AttApiClient.authorizeUser({scope:"MIM,IMMN"}, function() {
    document.getElementById("create").onclick = function() {
      AttApiClient.createMessageIndex(success, fail);
    };
    document.getElementById("list").onclick = function() {
	  var val1 = document.getElementById("msgId").value;
      AttApiClient.getMessageList({count: val1}, successWithJsonObject, fail);
    };
    document.getElementById("send").onclick = function() {
      var formData = new FormData();
      var filepicker = document.getElementById("filepicker");
      var file = filepicker.files[0];
      formData.append("file", file);
	  //From: 4252832032
	  var val1 = document.getElementById("msgId").value;
      AttApiClient.sendMessage({
        addresses:"tel:4252832032",
        message: val1,
        subject:"my subject", 
        group:true, 
        attachments:formData
      }, successWithJsonObject, fail);
    };
    document.getElementById("content").onclick = function() {
 	  var val1 = document.getElementById("msgId").value;
	  AttApiClient.getMessageContent({messageId: val1, partNum: 0},
        function (blob) {
          document.getElementById("resultImg").src = URL.createObjectURL(blob);
        },
        fail
      );
    };
    document.getElementById("indexinfo").onclick = function() {
      AttApiClient.getMessageIndexInfo(successWithJsonObject, fail);
    };
    document.getElementById("delta").onclick = function() {
      AttApiClient.getMessageDelta("1394384248096", successWithJsonObject, fail);
    };
    document.getElementById("update").onclick = function() {
	  var val1 = document.getElementById("msgId").value;
      AttApiClient.updateMessage({id: val1, isUnread: true}, success, fail);
      //AttApiClient.updateMessages([{id:"r17", isUnread: true, isFavorite: false},{id:"I2", isUnread: true, isFavorite: true}], success, fail);
    }
    document.getElementById("delete").onclick = function() {
	  var val1 = document.getElementById("msgId").value;
      AttApiClient.deleteMessages(val1, success, fail);
    }
  });
}
</script>
</head>
<body onload="javascript:loaded();">
<button id="create">create</button>
<button id="indexinfo">index info</button>
<button id="delta">delta</button>
<button id="list">list</button>
<button id="content">content</button>
<button id="update">update</button>
<button id="delete">delete</button>
MsgId/Count/Message:<input id="msgId">
<button id="send">send</button>
<input type="file" id="filepicker">
<div id="result"></div>
<img id="resultImg">
</body>
</html>