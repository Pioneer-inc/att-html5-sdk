<html>
<head>
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script type="text/javascript" src="/lib/att-api-client.js"></script>
<script type="text/javascript">
function successWithJsonObject(response) {
  document.getElementById("result").innerText = JSON.stringify(response);
} 

function success(response) {
  var result = document.getElementById("result");
  if (typeof response === "undefined" || response === "") {
    result.innerText = "Success with no response.";
  }
  else if (response["responseJSON"]) {
    result.innerText = JSON.stringify(response.responseJSON);
  }
  else if (response["innerText"]) {
    result.innerText = response.responseText;
  }
  else {
    result.innerText = response;
  }
}

function fail(error) {
  var result = document.getElementById("result");
  if (error["responseJSON"]) {
    result.innerText = JSON.stringify(error.responseJSON);
  }
  else {
    result.innerText = error.responseText;
  }
}

function loaded() {
  AttApiClient.authorizeUser({scope:"MIM,IMMN"}, function() {
    document.getElementById("create").onclick = function() {
      AttApiClient.createMessageIndex(success, fail);
    };
    document.getElementById("list").onclick = function() {
      AttApiClient.getMessageList(successWithJsonObject, fail);
    };
    document.getElementById("send").onclick = function() {
      var formData = new FormData();
      var filepicker = document.getElementById("filepicker");
      var file = filepicker.files[0];
      formData.append("file", file);
      AttApiClient.sendMessage({
        addresses:"tel:4259221966",
        message:"hi from Bruce's test",
        subject:"my subject", 
        group:true, 
        attachments:formData
      }, successWithJsonObject, fail);
    };
    document.getElementById("content").onclick = function() {
      AttApiClient.getMessageContent({messageId: "I7", partNum: 0},
        function (blob) {
          document.getElementById("resultImg").src = URL.createObjectURL(blob);
        },
        fail
      );
    };
    document.getElementById("indexinfo").onclick = function() {
      AttApiClient.getMessageIndexInfo(successWithJsonObject, fail);
    };
    document.getElementById("delta").onclick = function() {
      AttApiClient.getMessageDelta("1394130740730", successWithJsonObject, fail);
    };
    document.getElementById("update").onclick = function() {
      AttApiClient.updateMessages([{id:"I7", isUnread: true, isFavorite: true},{id:"I10", isUnread: true, isFavorite: true}], success, fail);
    }
  });
}
</script>
</head>
<body onload="javascript:loaded();">
<button id="create">create</button>
<button id="list">list</button>
<button id="send">send</button>
<button id="content">content</button>
<button id="indexinfo">index info</button>
<button id="delta">delta</button>
<button id="update">update</button>
<input type="file" id="filepicker">
<div id="result"></div>
<img id="resultImg">
</body>
</html>