<?php
if (!file_exists("config.php")) {
	header('X-PHP-Response-Code: 400', true, 400);
	header("Content-Type:application/json");	
	echo "{\"error\":\"config.php does not exist.\"}";
	exit;
} else {
	require_once("config.php");
}

try {
	if (!file_exists("service_provider/DC_ServiceProvider.php")) throw new Exception ('service_provider/DC_ServiceProvider.php does not exist'); 
	else require_once("service_provider/DC_ServiceProvider.php");

	$response = "Invalid API Call";

	list($blank, $operation) = split('[/]', $_SERVER['PATH_INFO']);
	$dc_provider = new DC_ServiceProvider($config);	
	switch (strtolower($operation)) {
		case "info":
			$response = $dc_provider->deviceInfo();
			break;
		default:
			$response = 'Invalid API Call - operation ' . $operation . ' is not supported. PATH_INFO: ' . var_dump($_SERVER['PATH_INFO']);
	}
	if (DEBUG) {
		Debug::init();
		$objDateTime = new DateTime('NOW');
		$now = $objDateTime->format('c');
		Debug::write("$now : $operation : $response");
		Debug::end();
	}
	header("Content-Type:application/json");
	echo $response;
}
catch(ServiceException $se) {
	return_json_error($se->getErrorCode(), $se->getErrorResponse());
}
catch(Exception $e) {
	return_json_error(400, $e->getMessage());
}

?>
